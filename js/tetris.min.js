(()=>{function Z(a){return new Promise(b=>setTimeout(b,a))}function aa(a){const b=document.createElement("div");b.id="modal-box";const c=document.createElement("div");c.id="inner-modal-box";const d=document.createElement("span");d.id="modal-message";const f=document.createElement("span");f.id="close-button";f.innerHTML="&times;";c.appendChild(d);c.appendChild(f);b.appendChild(c);d.innerText=a;document.getElementsByTagName("html")[0].appendChild(b);f.addEventListener("click",()=>{b.remove()})}let q=
950,J=!1,E=!1,z=!1,r=!1,F=!1,k="",g=1,l=0,A=Math.floor(7*Math.random()),t="",B=!0,C=!0,x=0;const ba=document.getElementById("gameBoard"),G=Number(function(a){a+="=";for(var b=decodeURIComponent(document.cookie).split(";"),c=0;c<b.length;c++){for(var d=b[c];" "===d.charAt(0);)d=d.substring(1);if(0===d.indexOf(a))return d.substring(a.length,d.length)}return""}("tetrisHighScore"));var n=q;const e=[],p=()=>Array.from(document.querySelectorAll(".moving")),ea=a=>{switch(a.key){case "ArrowLeft":C&&K(-1);
break;case "ArrowRight":C&&K(1);break;case " ":n=100;break;case "r":case "R":case "ArrowUp":if(!r||"sq"===k)break;ca();break;case "h":case "H":B&&(B=!1,L(),""===t?(t=k,M(),H(!1,t)):(a=t,t=k,H(!0,a),M()));break;case "ArrowDown":r&&da()}},N=(a,b,c)=>{document.getElementById(a+"-"+b).classList.add("moving");document.getElementById(a+"-"+b).classList.add(c);e[a][b]=1},u=a=>a.some(b=>0>b[0]||9<b[0]||0>b[1]||19<b[1]||0!==e[b[0]][b[1]]),v=(a,b)=>{a.forEach(c=>{N(c[0],c[1],b)})},ca=()=>{const a=[];p().forEach(c=>
{const [d,f]=m(c.id);document.getElementById(d+"-"+f).classList.remove("moving");e[d][f]=0;a.push([d,f]);y(c)});if("st"===k){var b=fa(a);if(u(b)){v(a,"cyan");return}w(b,"cyan")}else if("tt"===k){b=ha(a);if(u(b)){v(a,"blue");return}w(b,"blue")}else if("rl"===k){b=ia(a);if(u(b)){v(a,"orange");return}w(b,"orange")}else if("ml"===k){b=ja(a);if(u(b)){v(a,"green");return}w(b,"green")}else if("rz"===k){b=ka(a);if(u(b)){v(a,"purple");return}w(b,"purple")}else if("mz"===k){b=la(a);if(u(b)){v(a,"red");return}w(b,
"red")}D()},w=(a,b)=>{g++;a.forEach(c=>{N(c[0],c[1],b)});5===g&&(g=1)},la=a=>{const b=[];1===g?(b.push([a[0][0]+1,a[0][1]-1]),b.push([a[1][0],a[1][1]-2]),b.push([a[2][0]+1,a[2][1]+1]),b.push([a[3][0],a[3][1]])):2===g?(b.push([a[0][0]+2,a[0][1]]),b.push([a[1][0]+1,a[1][1]+1]),b.push([a[2][0],a[2][1]]),b.push([a[3][0]-1,a[3][1]+1])):3===g?(b.push([a[0][0],a[0][1]]),b.push([a[1][0]-1,a[1][1]-1]),b.push([a[2][0],a[2][1]+2]),b.push([a[3][0]-1,a[3][1]+1])):4===g&&(b.push([a[0][0]+1,a[0][1]-1]),b.push([a[1][0],
a[1][1]]),b.push([a[2][0]-1,a[2][1]-1]),b.push([a[3][0]-2,a[3][1]]));return b},ka=a=>{const b=[];1===g?(b.push([a[0][0]+1,a[0][1]+1]),b.push([a[1][0],a[1][1]]),b.push([a[2][0]-1,a[2][1]+1]),b.push([a[3][0]-2,a[3][1]])):2===g?(b.push([a[0][0],a[0][1]-2]),b.push([a[1][0],a[1][1]]),b.push([a[2][0]-1,a[2][1]-1]),b.push([a[3][0]-1,a[3][1]+1])):3===g?(b.push([a[0][0]+2,a[0][1]]),b.push([a[1][0]+1,a[1][1]-1]),b.push([a[2][0],a[2][1]]),b.push([a[3][0]-1,a[3][1]-1])):4===g&&(b.push([a[0][0]+1,a[0][1]-1]),
b.push([a[1][0]+1,a[1][1]+1]),b.push([a[2][0],a[2][1]]),b.push([a[3][0],a[3][1]+2]));return b},ja=a=>{const b=[];1===g?(b.push([a[0][0]+1,a[0][1]-1]),b.push([a[1][0]+2,a[1][1]+2]),b.push([a[2][0]+1,a[2][1]+1]),b.push([a[3][0],a[3][1]])):2===g?(b.push([a[0][0]+1,a[0][1]+1]),b.push([a[1][0],a[1][1]]),b.push([a[2][0]-1,a[2][1]+1]),b.push([a[3][0]-2,a[3][1]+2])):3===g?(b.push([a[0][0],a[0][1]]),b.push([a[1][0]-1,a[1][1]-1]),b.push([a[2][0]-2,a[2][1]-2]),b.push([a[3][0]-1,a[3][1]+1])):4===g&&(b.push([a[0][0]+
2,a[0][1]-2]),b.push([a[1][0]+1,a[1][1]-1]),b.push([a[2][0],a[2][1]]),b.push([a[3][0]-1,a[3][1]-1]));return b},ia=a=>{const b=[];1===g?(b.push([a[0][0]+2,a[0][1]+2]),b.push([a[1][0]+1,a[1][1]+1]),b.push([a[2][0],a[2][1]]),b.push([a[3][0]-1,a[3][1]+1])):2===g?(b.push([a[0][0],a[0][1]]),b.push([a[1][0]-1,a[1][1]-1]),b.push([a[2][0]-1,a[2][1]+1]),b.push([a[3][0]-2,a[3][1]+2])):3===g?(b.push([a[0][0]+1,a[0][1]-1]),b.push([a[1][0],a[1][1]]),b.push([a[2][0]-1,a[2][1]-1]),b.push([a[3][0]-2,a[3][1]-2])):
4===g&&(b.push([a[0][0]+2,a[0][1]-2]),b.push([a[1][0]+1,a[1][1]-1]),b.push([a[2][0]+1,a[2][1]+1]),b.push([a[3][0],a[3][1]]));return b},ha=a=>{const b=[];1===g?(b.push([a[0][0],a[0][1]]),b.push([a[1][0],a[1][1]]),b.push([a[2][0],a[2][1]]),b.push([a[3][0]+1,a[3][1]-1])):2===g?(b.push([a[0][0]+1,a[0][1]+1]),b.push([a[1][0],a[1][1]]),b.push([a[2][0],a[2][1]]),b.push([a[3][0],a[3][1]])):3===g?(b.push([a[0][0]-1,a[0][1]+1]),b.push([a[1][0],a[1][1]]),b.push([a[2][0],a[2][1]]),b.push([a[3][0],a[3][1]])):
4===g&&(b.push([a[0][0],a[0][1]]),b.push([a[1][0],a[1][1]]),b.push([a[2][0],a[2][1]]),b.push([a[3][0]-1,a[3][1]-1]));return b},fa=a=>{const b=[];1===g||3===g?(b.push([a[0][0]-1,a[0][1]+1]),b.push([a[1][0],a[1][1]]),b.push([a[2][0]+1,a[2][1]-1]),b.push([a[3][0]+2,a[3][1]-2])):(b.push([a[0][0]+1,a[0][1]-1]),b.push([a[1][0],a[1][1]]),b.push([a[2][0]-1,a[2][1]+1]),b.push([a[3][0]-2,a[3][1]+2]));return b},ma=a=>{" "===a.key&&(n=q)},K=a=>{const b=[],c=p();if(-1!==a||!c.some(d=>0===Number(d.id.charAt(0))))if(1!==
a||!c.some(d=>9===Number(d.id.charAt(0)))){for(let d of c){const [f,h]=m(d.id);if(2===e[f+a][h])return}c.forEach(d=>{const [f,h]=m(d.id);document.getElementById(f+"-"+h).classList.remove("moving");e[f][h]=0;b.push([f,h])});b.forEach(d=>{document.getElementById(d[0]+a+"-"+d[1]).classList.add("moving");O(document.getElementById(d[0]+"-"+d[1]),document.getElementById(d[0]+a+"-"+d[1]),"moving");e[d[0]+a][d[1]]=1});D()}},na=()=>{E||(z=J=!0,P())},pa=()=>{let a=0;for(let d=19;0<=d;d--){var b=0;for(var c=
0;10>c;c++)2===e[c][d]&&b++;if(10===b){b=d;for(c=0;10>c;c++)e[c][b]=0,document.getElementById(c+"-"+b).classList.remove("placed");b=d;for(c=19;0<=c;c--)for(let f=0;10>f;f++)if(!(c>b))if(c<=b&&0!==c){document.getElementById(f+"-"+c).classList.remove("placed");e[f][c]=e[f][c-1];const h=oa(f,c);2===e[f][c]&&(document.getElementById(f+"-"+c).classList.add("placed"),document.getElementById(f+"-"+c).classList.add(h))}else document.getElementById(f+"-"+c).classList.remove("placed"),e[f][c]=0,y(document.getElementById(f+
"-"+c));d++;a++}}switch(a){case 1:l+=40;break;case 2:l+=100;break;case 3:l+=300;break;case 4:l+=1200}document.getElementById("points").textContent=l},P=()=>{z?(H(!1,null),C=B=!0,x++,20===x?n=q=850:35===x?n=q=750:55===x?n=q=600:110===x&&(n=q=400)):r&&(qa(),B=!1);F&&ra();Z(n).then(()=>{J&&!E&&P()})},Q=(a,b)=>{for(let c=0;4>c;c++)document.getElementById(a+"-"+c+b).classList.add("cyan")},R=(a,b)=>{for(var c=0;2>c;c++)document.getElementById(a+"-"+(c+1)+b).classList.add("yellow");for(c=0;2>c;c++)document.getElementById(a+
1+"-"+(c+1)+b).classList.add("yellow")},S=(a,b)=>{for(let c=0;3>c;c++)document.getElementById(a+"-"+(c+1)+b).classList.add("orange");document.getElementById(a+1+"-3"+b).classList.add("orange")},T=(a,b)=>{for(let c=0;3>c;c++)document.getElementById(a+"-"+(c+1)+b).classList.add("green");document.getElementById(a-1+"-3"+b).classList.add("green")},U=(a,b)=>{for(let c=0;3>c;c++)document.getElementById(a+"-"+(c+1)+b).classList.add("blue");document.getElementById(a-1+"-2"+b).classList.add("blue")},V=(a,
b)=>{for(var c=0;2>c;c++)document.getElementById(a+"-"+(c+1)+b).classList.add("purple");for(c=0;2>c;c++)document.getElementById(a+1+"-"+(c+2)+b).classList.add("purple")},W=(a,b)=>{for(var c=0;2>c;c++)document.getElementById(a+"-"+(c+1)+b).classList.add("red");for(c=0;2>c;c++)document.getElementById(a-1+"-"+(c+2)+b).classList.add("red")},L=()=>{p().forEach(a=>{const [b,c]=m(a.id);y(a);a.classList.remove("moving");e[b][c]=0})},M=()=>{X("heldPeice");switch(t){case "st":Q(1,"-h");break;case "sq":R(1,
"-h");break;case "rl":S(1,"-h");break;case "tt":U(2,"-h");break;case "ml":T(2,"-h");break;case "rz":V(1,"-h");break;case "mz":W(2,"-h")}},X=a=>{Array.from(document.getElementById(a).children).forEach(b=>{Array.from(b.children).forEach(c=>y(c))})},H=(a,b)=>{if(a)a=b;else{a=A;do A=Math.floor(7*Math.random());while(A===a);X("nextPeice");switch(A){case 0:Q(1,"-n");break;case 1:R(1,"-n");break;case 2:S(1,"-n");break;case 3:U(2,"-n");break;case 4:T(2,"-n");break;case 5:V(1,"-n");break;case 6:W(2,"-n")}}if(sa(a))E=
!0,aa("Game Over!"),l>G&&(a=l,b=new Date,b.setTime(b.getTime()+2592E6),document.cookie="tetrisHighScore="+a+";expires="+b.toUTCString()+";path=/;SameSite=Lax",document.getElementById("highPoints").textContent=l);else{switch(a){case 0:case "st":for(a=0;4>a;a++)document.getElementById("2-"+a).classList.add("moving"),document.getElementById("2-"+a).classList.add("cyan"),e[2][a]=1;k="st";break;case 1:case "sq":for(a=0;2>a;a++)document.getElementById("2-"+a).classList.add("moving"),document.getElementById("2-"+
a).classList.add("yellow"),e[2][a]=1;for(a=0;2>a;a++)document.getElementById("3-"+a).classList.add("moving"),document.getElementById("3-"+a).classList.add("yellow"),e[3][a]=1;k="sq";break;case 2:case "rl":for(a=0;3>a;a++)document.getElementById("2-"+a).classList.add("moving"),document.getElementById("2-"+a).classList.add("orange"),e[2][a]=1;document.getElementById("3-2").classList.add("moving");document.getElementById("3-2").classList.add("orange");e[3][2]=1;k="rl";break;case 3:case "tt":for(a=0;3>
a;a++)document.getElementById("2-"+a).classList.add("moving"),document.getElementById("2-"+a).classList.add("blue"),e[2][a]=1;document.getElementById("1-1").classList.add("moving");document.getElementById("1-1").classList.add("blue");e[1][1]=1;k="tt";break;case 4:case "ml":for(a=0;3>a;a++)document.getElementById("2-"+a).classList.add("moving"),document.getElementById("2-"+a).classList.add("green"),e[2][a]=1;document.getElementById("1-2").classList.add("moving");document.getElementById("1-2").classList.add("green");
e[1][2]=1;k="ml";break;case 5:case "rz":for(a=0;2>a;a++)document.getElementById("2-"+a).classList.add("moving"),document.getElementById("2-"+a).classList.add("purple"),e[2][a]=1;for(a=0;2>a;a++)document.getElementById("3-"+(a+1)).classList.add("moving"),document.getElementById("3-"+(a+1)).classList.add("purple"),e[3][a+1]=1;k="rz";break;case 6:case "mz":for(a=0;2>a;a++)document.getElementById("2-"+a).classList.add("moving"),document.getElementById("2-"+a).classList.add("red"),e[2][a]=1;for(a=0;2>
a;a++)document.getElementById("1-"+(a+1)).classList.add("moving"),document.getElementById("1-"+(a+1)).classList.add("red"),e[1][a+1]=1;k="mz"}z=!1;r=!0;D()}},sa=a=>{if(0===a)return 0!==e[2][0]||0!==e[2][1]||0!==e[2][2]||0!==e[2][3];if(1===a)return 0!==e[2][0]||0!==e[2][1]||0!==e[3][0]||0!==e[3][1];if(2===a)return 0!==e[2][0]||0!==e[2][1]||0!==e[2][2]||0!==e[3][2];if(3===a)return 0!==e[2][0]||0!==e[2][1]||0!==e[2][2]||0!==e[1][1];if(4===a)return 0!==e[2][0]||0!==e[2][1]||0!==e[2][2]||0!==e[1][2];if(5===
a)return 0!==e[2][0]||0!==e[2][1]||0!==e[3][1]||0!==e[3][2];if(6===a)return 0!==e[2][0]||0!==e[2][1]||0!==e[1][1]||0!==e[1][2]},qa=()=>{const a=p();if(ta(a))r=!1,F=!0;else{var b=[];a.forEach(c=>{const [d,f]=m(c.id);document.getElementById(d+"-"+f).classList.remove("moving");e[d][f]=0;b.push([d,f])});b.forEach(c=>{document.getElementById(c[0]+"-"+(c[1]+1)).classList.add("moving");e[c[0]][c[1]+1]=1;O(document.getElementById(c[0]+"-"+c[1]),document.getElementById(c[0]+"-"+(c[1]+1)),"moving")});D()}},
da=()=>{I();const a=[];for(p().forEach(b=>{const [c,d]=m(b.id);a.push([c,d])});Y(a);)a.forEach(b=>{b[1]+=1});ua(a);C=!1},ua=a=>{L();a.forEach(b=>{const c=document.getElementById(b[0]+"-"+b[1]);c.classList.add("moving");e[b[0]][b[1]]=1;switch(k){case "st":c.classList.add("cyan");break;case "sq":c.classList.add("yellow");break;case "rl":c.classList.add("orange");break;case "tt":c.classList.add("blue");break;case "ml":c.classList.add("green");break;case "rz":c.classList.add("purple");break;case "mz":c.classList.add("red")}})},
ta=a=>{let b=!1;a.forEach(c=>{const [d,f]=m(c.id);if(19===f||2===e[d][f+1])b=!0});return b},ra=()=>{p().forEach(a=>{a.classList.remove("moving");a.classList.add("placed");const [b,c]=m(a.id);e[b][c]=2});pa();F=!1;z=!0;g=1},m=a=>{a=a.split("-");return[Number(a[0]),Number(a[1])]},y=a=>{a.classList.contains("blue")?a.classList.remove("blue"):a.classList.contains("red")?a.classList.remove("red"):a.classList.contains("yellow")?a.classList.remove("yellow"):a.classList.contains("green")?a.classList.remove("green"):
a.classList.contains("cyan")?a.classList.remove("cyan"):a.classList.contains("purple")?a.classList.remove("purple"):a.classList.contains("orange")&&a.classList.remove("orange")},oa=(a,b)=>{const c=document.getElementById(a+"-"+(b-1));y(document.getElementById(a+"-"+b));if(c.classList.contains("blue"))return"blue";if(c.classList.contains("red"))return"red";if(c.classList.contains("yellow"))return"yellow";if(c.classList.contains("green"))return"green";if(c.classList.contains("cyan"))return"cyan";if(c.classList.contains("purple"))return"purple";
if(c.classList.contains("orange"))return"orange"},O=(a,b,c)=>{a.classList.contains("blue")?(b.classList.add("blue"),a.classList.contains(c)||a.classList.remove("blue")):a.classList.contains("red")?(b.classList.add("red"),a.classList.contains(c)||a.classList.remove("red")):a.classList.contains("yellow")?(b.classList.add("yellow"),a.classList.contains(c)||a.classList.remove("yellow")):a.classList.contains("green")?(b.classList.add("green"),a.classList.contains(c)||a.classList.remove("green")):a.classList.contains("cyan")?
(b.classList.add("cyan"),a.classList.contains(c)||a.classList.remove("cyan")):a.classList.contains("purple")?(b.classList.add("purple"),a.classList.contains(c)||a.classList.remove("purple")):a.classList.contains("orange")&&(b.classList.add("orange"),a.classList.contains(c)||a.classList.remove("orange"))},va=()=>{const a=document.getElementById("ctrlList"),b=document.getElementById("hideBtn");a.classList.contains("hidden")?(a.classList.remove("hidden"),b.textContent="Hide"):(a.classList.add("hidden"),
b.textContent="Show")},I=()=>{Array.from(document.querySelectorAll(".flashOn")).forEach(a=>{a.classList.remove("flashOn")})},Y=a=>{for(const b of a)if(19===b[1]||2===e[b[0]][b[1]+1])return!1;return!0},D=()=>{if(r){const a=[],b=[];p().forEach(d=>{const [f,h]=m(d.id);a.push([f,h]);b.push([f,h])});let c=0;for(const d of a)d[1]>c&&(c=d[1]);for(;Y(a);)a.forEach(d=>{d[1]+=1});wa(b,a)?I():(I(),a.forEach(d=>{document.getElementById(d[0]+"-"+d[1]).firstChild.classList.add("flashOn")}))}},wa=(a,b)=>{for(const c of a)for(const d of b)if(c[0]===
d[0]&&c[1]===d[1])return!0;return!1};(()=>{for(var a=0;10>a;a++){var b=document.createElement("div");b.id="col-"+a;b.classList.add("col");ba.appendChild(b);e.push([]);for(var c=0;20>c;c++){var d=document.createElement("div");d.id=a+"-"+c;d.classList.add("cell");b.appendChild(d);e[a].push(0);var f=document.createElement("div");f.id="f"+a+"-"+c;f.classList.add("flash");d.appendChild(f)}}b=document.getElementById("nextPeice");a=document.getElementById("heldPeice");for(c=0;4>c;c++)for(d=document.createElement("div"),
d.id="col-"+c+"-n",d.classList.add("col"),b.appendChild(d),f=0;4>f;f++){const h=document.createElement("div");h.id=c+"-"+f+"-n";h.classList.add("cell");d.appendChild(h)}for(b=0;4>b;b++)for(c=document.createElement("div"),c.id="col-"+b+"-h",c.classList.add("col"),a.appendChild(c),d=0;4>d;d++)f=document.createElement("div"),f.id=b+"-"+d+"-h",f.classList.add("cell"),c.appendChild(f);document.getElementById("startBtn").addEventListener("click",na);document.addEventListener("keydown",ea);document.addEventListener("keyup",
ma);document.getElementById("hideBtn").addEventListener("click",va);document.getElementById("points").textContent=l;document.getElementById("highPoints").textContent=0<G?G:" No High Score";window.onkeydown=h=>!((" "===h.key||"ArrowUp"===h.key||"ArrowDown"===h.key)&&h.target===document.body)})()})();
